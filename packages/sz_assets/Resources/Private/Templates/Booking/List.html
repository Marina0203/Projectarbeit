<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://typo3.org/ns/TYPO3Fluid/Fluid/ViewHelpers"
      xmlns:sz="http://typo3.org/ns/SUNZINET/SzAssets/ViewHelpers"
      data-namespace-typo3-fluid="true">
<f:layout name="Default"/>
<f:section name="Main">
    <f:debug>{_all}</f:debug>
    <section class="plugin-booking">
        <div class="container">
            <h1>
                BOOKING APP
            </h1>
            <f:comment><!-- Fehlermeldung, falls z.B. ein Raum voll gebucht ist --></f:comment>
            <f:flashMessages as="flashMessages">
                <f:for each="{flashMessages}" as="flashMessage">
                    <div class="alert alert-error">
                        <strong>{flashMessage.title}</strong> {flashMessage.message}
                    </div>
                </f:for>
            </f:flashMessages>
            <f:if condition="{rooms}">
                <f:comment><!-- Auswahl f체r den Tag --></f:comment>
                <f:form id="dayUpdate" action="list" controller="Booking" name="booking">
                    <div class="row mb-4">
                        <div class="col">
                            <label for="day" class="form-label">Tag</label>
                            <f:form.textfield id="day" class="form-control" name="day" type="date" value="{day}"/>
                        </div>
                    </div>
                </f:form>

                <div class="row">
                    <f:comment><!-- Auflistung der R채ume --></f:comment>
                    <f:for each="{rooms}" as="room" iteration="i">
                        <div class="col col-md-4 mb-4{f:if(condition: room.cssClass, then: ' {room.cssClass}')}">
                            <div class="card bg-dark">
                                <div class="card-body">
                                    <h5 class="card-title">{room.title}</h5>
                                    <f:comment><!-- Auflistung der Sitzpl채tze --></f:comment>
                                    <f:for each="{room.seats}" as="seat" iteration="i">
                                        <sz:seat bookings="{bookings}" seatId="{seat.uid}"/>

                                        <f:comment><!-- Dialog windows for each seat --></f:comment>
                                        <dialog id="dialog-{seat.uid}" class="w-50">
                                            <button class="btn-close" data-dialog="dialog-{seat.uid}" autofocus></button>
                                            Sitzplatz ID: {seat.uid}
                                            <div class="row">
                                                <f:form action="book" controller="Booking" name="booking">
                                                    <f:form.hidden name="startDate" value="{day}"/>
                                                    <f:form.hidden name="room" value="{room.uid}"/>
                                                    <f:form.hidden name="seat" value="{seat.uid}"/>
                                                    <div class="mb-3">
                                                        <label for="firstName-{i.cycle}" class="form-label">Vorname*</label>
                                                        <f:form.textfield id="firstName-{i.cycle}" class="form-control"
                                                                          name="userFirstName" required="true"/>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="lastName-{i.cycle}" class="form-label">Nachname*</label>
                                                        <f:form.textfield id="lastName-{i.cycle}" class="form-control"
                                                                          name="userLastName" required="true"/>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="email-{i.cycle}" class="form-label">Email*</label>
                                                        <f:form.textfield id="email-{i.cycle}" class="form-control"
                                                                          name="userEmail" type="email" required="true"/>
                                                    </div>
                                                    <f:form.submit class="btn btn-primary" value="Book"/>
                                                </f:form>
                                            </div>
                                        </dialog>
                                    </f:for>
                                </div>
                            </div>
                        </div>
                    </f:for>
                </div>
            </f:if>
        </div>
    </section>

    <f:comment><!-- JavaScript Funktion f체r die Dialog Boxen --></f:comment>
    <script>
        const daySelect = document.getElementById('day');
        const dialogs = document.querySelectorAll('dialog');
        const showDialogButton = document.querySelectorAll('.btn-dialog');
        const closeDialogButton = document.querySelectorAll('.btn-close');

        // On day change, submit the form
        daySelect.addEventListener('change', () => {
            document.querySelector('#dayUpdate').submit();
        });

        // Add event listeners for showing each dialog
        showDialogButton.forEach((button) => {
            button.addEventListener('click', () => {
                dialogs[button.id-1].showModal();
            });
        });

        // Add event listeners for closing each dialog
        closeDialogButton.forEach((button) => {
            button.addEventListener('click', () => {
                document.querySelector(`#${button.dataset.dialog}`).close();
            });
        });
    </script>
</f:section>
</html>
